<!doctype html>
<html lang="en" class="fx-glow">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AMI DATA PORTAL</title>
  <link rel="stylesheet" href="/styles/shared.css?v=20250306">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
  <style>
    /* Shell-specific layout */
    body.shell-app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    @keyframes chrome-shift {
      0% {
        background-position: center, 40% 20%;
      }
      38% {
        background-position: center, 58% 40%;
      }
      62% {
        background-position: center, 32% 70%;
      }
      100% {
        background-position: center, 40% 20%;
      }
    }

    .shell-chrome {
      position: sticky;
      top: 0;
      z-index: 9;
      display: flex;
      flex-direction: column;
      flex: 0 0 auto;
      overflow: hidden;
      background-color: var(--panel);
      background-image:
        linear-gradient(180deg, color-mix(in oklab, var(--panel) 90%, transparent) 0%, color-mix(in oklab, var(--panel) 96%, var(--accent) 6%) 100%),
        var(--chrome-gradient);
      background-size: 100% 100%, 200% 100%;
      background-blend-mode: soft-light, normal;
      animation: chrome-shift 12s ease-in-out infinite;
      border-bottom: 1px solid var(--border);
    }
    #tabsBar {
      display: flex;
      gap: 8px;
      padding: 6px 12px 0;
      align-items: flex-end;
      position: relative;
      z-index: 3;
      overflow: hidden;
    }
    .tab-strip {
      display: flex;
      align-items: flex-end;
      gap: 8px;
      width: 100%;
    }
    .tab-strip__track {
      display: flex;
      align-items: flex-end;
      gap: 2px;
      flex: 1 1 auto;
      overflow-x: auto;
      overflow-y: hidden;
      padding-bottom: 2px;
      scrollbar-width: none;
    }
    .tab-strip__track::-webkit-scrollbar { display: none; }
    .tab-strip__add {
      flex: 0 0 auto;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(0, 0, 0, 0.42);
      color: rgba(255, 255, 255, 0.86);
      font-weight: 600;
      cursor: pointer;
      height: 32px;
      min-width: 32px;
      transition: background var(--duration-medium) var(--easing-standard),
        border-color var(--duration-medium) var(--easing-standard),
        color var(--duration-medium) var(--easing-standard);
    }
    .tab-strip__add:hover {
      background: rgba(0, 0, 0, 0.58);
      border-color: rgba(255, 255, 255, 0.2);
    }
    .tab-strip__add:focus-visible {
      outline: none;
      box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 35%, transparent);
    }
    body.shell-app > .shell-chrome { flex: 0 0 auto; }
    .tab {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-bottom-color: rgba(255, 255, 255, 0.06);
      background: rgba(0, 0, 0, 0.42);
      color: rgba(255, 255, 255, 1);
      border-radius: 12px 12px 0 0;
      cursor: pointer;
      margin-bottom: -1px;
      position: relative;
      transition:
        color var(--duration-medium) var(--easing-standard),
        background var(--duration-medium) var(--easing-standard),
        border-color var(--duration-medium) var(--easing-standard),
        box-shadow var(--duration-medium) var(--easing-standard),
        padding var(--duration-medium) var(--easing-standard);
      will-change: transform;
    }
    .tab:not(.active):hover {
      background: rgba(0, 0, 0, 0.54);
      color: rgba(255, 255, 255, 1);
      border-color: rgba(255, 255, 255, 0.18);
    }
    .tab:focus-visible {
      outline: none;
      box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 35%, transparent);
    }
    .tab.active {
      padding: 8px 16px;
      background: var(--bg);
      color: var(--text);
      border-color: color-mix(in oklab, var(--border) 45%, transparent);
      border-bottom-color: var(--bg);
      box-shadow:
        -18px 0 28px -20px rgba(0, 0, 0, 0.55),
        18px 0 28px -20px rgba(0, 0, 0, 0.55);
      z-index: 4;
    }
    .tab.active:focus-visible {
      box-shadow:
        -12px 0 24px rgba(0, 0, 0, 0.4),
        12px 0 24px rgba(0, 0, 0, 0.4),
        0 0 0 2px color-mix(in oklab, var(--accent) 35%, transparent);
    }
    .tab .icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      font-size: 18px;
      color: inherit;
    }
    .tab .status-indicator {
      margin-left: 6px;
    }
    .tab__label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      line-height: 1.1;
    }
    .tab .icon i {
      font-size: inherit;
      line-height: 1;
      color: inherit;
    }
    /* Served: bump icon size; keep default color */
    .tab.served .icon {
      width: 18px;
      height: 18px;
      font-size: 18px;
    }
    /* Served indicator: unified green dot */
    .tab .pill { margin-left: 6px; }
    .tab .close {
      margin-left: 8px;
      opacity: 0.8;
      font-size: 18px;
      line-height: 1;
      width: 20px;
      height: 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .tab.dragging {
      cursor: grabbing;
      background: var(--bg);
      color: var(--text);
      border-color: color-mix(in oklab, var(--border) 45%, transparent);
      border-bottom-color: var(--bg);
      padding: 8px 16px;
    }
    .frame-wrap {
      position: relative;
      flex: 1 1 auto;
      min-height: 0;
      background: #111;
      margin-top: -1px;
      overflow: hidden;
    }
    .frame-loading {
      position: absolute;
      inset: 0;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
      padding: 24px;
      background:
        radial-gradient(circle at top, color-mix(in oklab, var(--bg) 65%, transparent) 0%, transparent 72%),
        color-mix(in oklab, var(--panel) 82%, transparent);
      backdrop-filter: blur(var(--overlay-blur-strength));
      opacity: 0;
      pointer-events: none;
      transition: opacity 160ms var(--easing-standard);
    }
    .frame-loading--active {
      opacity: 1;
      pointer-events: auto;
    }
    .frame-loading__inner {
      display: inline-flex;
      align-items: center;
      gap: 14px;
      padding: 14px 18px;
      border-radius: 14px;
      background: rgba(7, 9, 14, 0.72);
      box-shadow: 0 18px 42px rgba(0, 0, 0, 0.42);
      border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
    }
    .frame-loading__spinner {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.18);
      border-top-color: color-mix(in oklab, var(--accent) 78%, white 22%);
      animation: frame-loading-spin 620ms linear infinite;
    }
    .frame-loading__label {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.015em;
      color: rgba(255, 255, 255, 0.92);
      text-transform: uppercase;
    }
    @keyframes frame-loading-spin {
      to { transform: rotate(360deg); }
    }
    /* Default dark; for file modes (A/B) use a light gray gradient */
    body.mode-file .frame-wrap {
      background: linear-gradient(180deg, #f7f7f8 0%, #ededf0 100%);
    }
    #vizFrame { width: 100%; height: 100%; border: 0; background: transparent; }
    header .right { display: inline-flex; gap: 8px; align-items: center; margin-left: auto; }
    #pathLabel { color: var(--muted); max-width: 40vw; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    /* Branding */
    .brand { display: inline-flex; align-items: center; gap: 10px; min-width: 280px; }
    .brand-logo { height: 42px; width: auto; object-fit: contain; display: block; animation: logo-spin 120s linear infinite; will-change: transform; }
    .brand-text { display: flex; flex-direction: column; gap: 2px; }
    .brand-text h1 { margin: 0; font-size: 20px; font-weight: 800; }
    .brand-text .subtitle { font-size: 13px; line-height: 1.1; letter-spacing: 0.06em; }
    @keyframes logo-spin { from { transform: rotate(0deg) } to { transform: rotate(360deg) } }
    /* Invert logo in dark theme for better contrast */
    [data-theme="dark"] .brand-logo { filter: invert(1) contrast(0.95) brightness(1.1); }
    .is-hidden { display: none !important; }
    .welcome-screen {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      overflow: hidden;
      background:
        radial-gradient(circle at top, color-mix(in oklab, var(--accent) 18%, transparent) 0%, transparent 62%),
        color-mix(in oklab, var(--panel) 94%, transparent);
      z-index: 3;
    }
    .welcome-card {
      position: relative;
      width: min(480px, 100%);
      margin: auto;
      padding: 48px 36px;
      border-radius: 18px;
      border: 1px solid color-mix(in oklab, var(--border) 55%, transparent);
      background-color: color-mix(in oklab, var(--panel) 58%, white 42%);
      background-image:
        linear-gradient(155deg, color-mix(in oklab, var(--accent) 16%, transparent) 0%, transparent 68%),
        var(--chrome-gradient);
      background-size: 100% 100%, 200% 100%;
      background-repeat: no-repeat, repeat;
      background-blend-mode: screen, normal;
      box-shadow: 0 32px 90px rgba(0,0,0,0.32);
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 18px;
      overflow: hidden;
    }
    .welcome-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image: var(--chrome-gradient);
      background-size: 260% 260%;
      opacity: 0.5;
      mix-blend-mode: color-dodge;
      filter: hue-rotate(0deg);
      animation: pixel-drift 28s linear infinite, pixel-spectrum 48s ease-in-out infinite;
      pointer-events: none;
    }
    .welcome-card > * { position: relative; z-index: 1; }
    @keyframes pixel-drift {
      0% { background-position: 0 0; }
      50% { background-position: 16px 12px; }
      100% { background-position: 0 0; }
    }
    @keyframes pixel-spectrum {
      0% { filter: hue-rotate(0deg); }
      50% { filter: hue-rotate(180deg); }
      100% { filter: hue-rotate(360deg); }
    }
    .welcome-card h2 {
      margin: 0;
      font-size: 28px;
      letter-spacing: -0.01em;
    }
    .welcome-card p { margin: 0; color: var(--muted); font-size: 15px; }
    .welcome-card .welcome-action {
      font-size: 18px;
      padding: 16px 28px;
      border-radius: 999px;
      border-width: 2px;
      font-weight: 600;
      letter-spacing: 0.03em;
    }
    .welcome-card .welcome-hint { font-size: 12px; }
    :root {
      --chrome-gradient-dark: linear-gradient(90deg, rgba(122, 162, 247, 0.7) 0%, rgba(244, 114, 182, 0.7) 100%);
      --chrome-gradient-light: linear-gradient(90deg, rgba(96, 165, 250, 0.6) 0%, rgba(251, 191, 36, 0.55) 100%);
      --chrome-gradient: var(--chrome-gradient-dark);
    }
    [data-theme="dark"] { --chrome-gradient: var(--chrome-gradient-dark); }
    [data-theme="light"] { --chrome-gradient: var(--chrome-gradient-light); }
    header {
      position: relative;
      top: auto;
      z-index: auto;
      background: transparent;
      border-bottom: 1px solid color-mix(in oklab, var(--border) 55%, transparent);
      box-shadow: none;
    }
    header > *, .welcome-screen > * { position: relative; z-index: 1; }
    .welcome-card { position: relative; z-index: 2; }
  </style>
  <script>
    (function() {
      try {
        const theme = localStorage.getItem('theme');
        if (theme) document.documentElement.setAttribute('data-theme', theme);
        // Always enable glow effect
        document.documentElement.classList.add('fx-glow');
      } catch {}
    })();
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css">
</head>
<body class="shell-app">
  <div id="shellConsole" class="shell-console" aria-hidden="true">
    <div class="shell-console__inner">
      <div class="shell-console__tabs">
        <div id="shellConsoleTabs" class="console-tab-strip" role="tablist"></div>
      </div>
      <div id="shellConsoleViewport" class="shell-console__terminal" role="presentation"></div>
    </div>
  </div>

  <div class="shell-chrome">
    <header>
      <div class="brand">
        <img class="brand-logo" src="/res/LOGO_DCD.png" onerror="this.onerror=null;this.src='/res/ami-logo.svg'" alt="AMI Logo" />
        <div class="brand-text">
          <h1>AMI DATA PORTAL</h1>
          <div class="muted subtitle">LIVE CONTENT DIRECTORY</div>
        </div>
      </div>
      <input id="globalSearch" type="search" placeholder="Search (/)" />
      <button class="icon-button" id="btnTheme" title="Toggle Theme" aria-label="Toggle Theme"><i id="iconTheme" class="ri-moon-clear-line" aria-hidden="true"></i></button>
      <button class="icon-button" id="selectMediaBtn" title="Content Directory" aria-label="Content Directory">
        <i class="ri-folders-line" aria-hidden="true"></i>
      </button>
      <button class="icon-button" id="accountDrawerBtn" title="Account Management" aria-label="Account Management">
        <i class="ri-user-settings-line" aria-hidden="true"></i>
      </button>
      <span class="right">
        <span id="statusPill" class="muted"></span>
        <span id="pathLabel" class="muted"></span>
      </span>
    </header>

    <div id="tabsBar"></div>
  </div>
  <div class="frame-wrap">
    <div id="frameLoadingOverlay" class="frame-loading" aria-hidden="true">
      <div class="frame-loading__inner">
        <div class="frame-loading__spinner" aria-hidden="true"></div>
        <span class="frame-loading__label">Loadingâ€¦</span>
      </div>
    </div>
    <iframe id="vizFrame" class="is-hidden" title="Visualizer"></iframe>
    <div id="welcomeScreen" class="welcome-screen">
      <div class="welcome-card">
        <h2>Welcome to the AMI Data Portal</h2>
        <p>Open the Content Directory to browse playbooks, resources, and live tools.</p>
        <button id="welcomeOpenBtn" class="btn welcome-action">
          <i class="ri-folders-line" aria-hidden="true"></i>
          Open Content Directory
        </button>
        <p class="welcome-hint muted">Tip: press / to focus search once you have a workspace open.</p>
      </div>
    </div>
  </div>

  <script defer src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
  <script type="module" src="/js/shell.js?v=20250306"></script>
  <style>
    /* Hide mode/path noise in shell header */
    #pathLabel { display: none !important; }
  </style>
</body>
</html>
